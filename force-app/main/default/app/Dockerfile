# Python 3.9 Slim ê¸°ë°˜ ì»¨í…Œì´ë„ˆ ì‚¬ìš©
FROM python:3.9-slim

# ì‘ì—… ë””ë ‰í† ë¦¬ ì„¤ì •
WORKDIR /app

# ì„œë¹„ìŠ¤ ê³„ì • í‚¤ ë³µì‚¬ (Google Cloud ì¸ì¦)
COPY service-account-key.json /app/service-account-key.json
ENV GOOGLE_APPLICATION_CREDENTIALS=/app/service-account-key.json

# í•„ìˆ˜ íŒ¨í‚¤ì§€ ë³µì‚¬ ë° ì„¤ì¹˜
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# ğŸ“Œ ëª¨ë¸ íŒŒì¼ ë³µì‚¬ (âœ… ì¶”ê°€ëœ ë¶€ë¶„)
COPY blurrcleardistinguishmodelreal.pth /app/blurrcleardistinguishmodelreal.pth

# ì•± ì½”ë“œ ë³µì‚¬
COPY . .

# Flask ì‹¤í–‰ í¬íŠ¸ ì„¤ì •
ENV PORT=8080

# ğŸš€ Gunicorn ì‹¤í–‰ ì‹œ worker ê°œìˆ˜ë¥¼ 1ê°œë¡œ ì„¤ì • + timeout ì¦ê°€
CMD ["gunicorn", "--workers", "1", "--timeout", "300", "--bind", "0.0.0.0:8080", "main:app"]
